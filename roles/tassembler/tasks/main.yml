---
# Configure application
- name: Copy about page
  copy:
    src: /var/www/text-assembler/textassembler_web/templates/textassembler_web/about.html.example
    dest: /var/www/text-assembler/textassembler_web/templates/textassembler_web/about.html
    remote_src: yes

- name: Copy footer page
  copy:
    src: /var/www/text-assembler/textassembler_web/templates/footer.html.example
    dest: /var/www/text-assembler/textassembler_web/templates/footer.html
    remote_src: yes

- name: Copy base page
  copy:
    src: /var/www/text-assembler/textassembler_web/templates/base.html.example
    dest: /var/www/text-assembler/textassembler_web/templates/base.html
    remote_src: yes

- name: Copy header page
  copy:
    src: /var/www/text-assembler/textassembler_web/templates/header.html.example
    dest: /var/www/text-assembler/textassembler_web/templates/header.html
    remote_src: yes

- name: Copy config
  copy:
    src: /var/www/text-assembler/textassembler.cfg.example
    dest: /var/www/text-assembler/textassembler.cfg
    remote_src: yes

# cp etc/init.d/* /etc/init.d/
- name: Copy textassembler etc files to init.d
  copy:
    remote_src: yes
    src: /var/www/text-assembler/etc/init.d/
    dest: /etc/init.d/
# systemctl daemon-reload
# systemctl enable tassemblerd
# systemctl start tassemblerd
- name: make tassemblerd executable
  file:
    path: /etc/init.d/tassemblerd
    mode: 0755
- name: enable tassemblerd
  command: systemctl enable tassemblerd
- name: start and enable tassemblerd
  systemd:
    name: tassemblerd
    state: started
    enabled: yes
    daemon-reload: yes
# systemctl enable tassemblerzipd
# systemctl start tassemblerzipd
- name: make tassemblerzipd executable
  file:
    path: /etc/init.d/tassemblerzipd
    mode: 0755
- name: enable tassemblerzipd
  command: systemctl enable tassemblerzipd
- name: start and enable tassemblerzipd
  systemd:
    name: tassemblerzipd
    state: started
    enabled: yes
# systemctl enable tassemblerdeld
# systemctl start tassemblerdeld
- name: make tassemblerdeld executable
  file:
    path: /etc/init.d/tassemblerdeld
    mode: 0755
- name: enable tassemblerdeld
  command: systemctl enable tassemblerdeld
- name: start and enable tassemblerdeld
  systemd:
    name: tassemblerdeld
    state: started
    enabled: yes
# edit crontab
- name: Add cron job to update sources and API limits
  blockinfile:
    create: yes
    path: /etc/crontab
    block: |
      @monthly    root        /var/www/text-assembler/ta_env/bin/python /var/www/text-assembler/manage.py update_sources
      @monthly    root        /var/www/text-assembler/ta_env/bin/python /var/www/text-assembler/manage.py update_limits

